#!/bin/bash
# evsieve gamepad hotkey config
# DS3 button combos â†’ script execution
# No grab = nonexclusive read, games still see controller
# persist=reopen = survives Bluetooth disconnect/reconnect
DEVICE="/dev/input/gamepad0"
export PATH="$HOME/bin:$HOME/.local/bin:$PATH"

# Wait for controller to appear
while [[ ! -e "$DEVICE" ]]; do
  sleep 1
done

exec evsieve \
  --input "$DEVICE" persist=reopen \
  --map abs:hat0x:1    btn:dpad_right:1 \
  --map abs:hat0x:-1   btn:dpad_left:1 \
  --map abs:hat0x:0    btn:dpad_left:0  btn:dpad_right:0 \
  --map abs:hat0y:1    btn:dpad_down:1 \
  --map abs:hat0y:-1   btn:dpad_up:1 \
  --map abs:hat0y:0    btn:dpad_down:0  btn:dpad_up:0 \
  --hook btn:select btn:tl                    period=200 exec-shell="emucloser" \
  --hook btn:select btn:dpad_up               period=200 exec-shell="xdotool key alt+Tab" \
  --hook btn:select btn:dpad_down             period=200 exec-shell="playerctl play-pause" \
  --hook btn:select btn:dpad_left             period=200 exec-shell="playerctl previous" \
  --hook btn:select btn:dpad_right            period=200 exec-shell="playerctl next" \
  --hook btn:start  btn:tr      btn:dpad_down period=200 exec-shell="esdepull" \
  --hook btn:start  btn:tr2     btn:dpad_down period=200 exec-shell="steampull" \
  --hook btn:start  btn:tl      btn:dpad_down period=200 exec-shell="spotpull" \
  --hook btn:start  btn:tl2     btn:dpad_down period=200 exec-shell="kasts"
